{
  "description": "Top-level spec that an AI model should emit as JSON.\n\nTime units:\n- start/duration are in beats (quarter note == 1 beat for denominator=4).\n- For other denominators, \"beat\" still means a quarter note beat for simplicity.\n  (This keeps time math predictable for models.)",
  "properties": {
    "title": {
      "default": "Untitled",
      "title": "Title",
      "type": "string"
    },
    "bpm": {
      "default": 120.0,
      "exclusiveMaximum": 400,
      "minimum": 20,
      "title": "Bpm",
      "type": "number"
    },
    "time_signature": {
      "$ref": "#/definitions/TimeSignature"
    },
    "key_signature": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "default": null,
      "title": "Key Signature"
    },
    "ppq": {
      "default": 480,
      "maximum": 9600,
      "minimum": 24,
      "title": "Ppq",
      "type": "integer"
    },
    "tracks": {
      "items": {
        "$ref": "#/definitions/Track"
      },
      "title": "Tracks",
      "type": "array"
    }
  },
  "title": "Composition",
  "type": "object",
  "definitions": {
    "LabeledNote": {
      "description": "A single note with explicit hand/voice labels.\n\nThis is an annotation structure; rendering only uses MIDI pitches + timing.",
      "properties": {
        "pitch": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            }
          ],
          "title": "Pitch"
        },
        "hand": {
          "enum": [
            "lh",
            "rh"
          ],
          "title": "Hand",
          "type": "string"
        },
        "voice": {
          "anyOf": [
            {
              "maximum": 4,
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Voice"
        }
      },
      "required": [
        "pitch",
        "hand"
      ],
      "title": "LabeledNote",
      "type": "object"
    },
    "NoteEvent": {
      "description": "A note or chord that starts at `start` (in beats) and lasts `duration` (in beats).\n\nProvide pitch content in exactly ONE of these forms:\n- Legacy: `pitch` (single) or `pitches` (chord)\n- New (preferred): `notes` (per-note hand/voice labels)\n- New (preferred): `groups` (per-sub-chord hand/voice labels)\n\n- Velocity defaults to a moderate piano dynamic.",
      "properties": {
        "type": {
          "const": "note",
          "default": "note",
          "title": "Type",
          "type": "string"
        },
        "start": {
          "minimum": 0,
          "title": "Start",
          "type": "number"
        },
        "duration": {
          "exclusiveMinimum": 0,
          "title": "Duration",
          "type": "number"
        },
        "pitch": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Pitch"
        },
        "pitches": {
          "anyOf": [
            {
              "items": {
                "anyOf": [
                  {
                    "type": "integer"
                  },
                  {
                    "type": "string"
                  }
                ]
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Pitches"
        },
        "notes": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/definitions/LabeledNote"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Notes"
        },
        "groups": {
          "anyOf": [
            {
              "items": {
                "$ref": "#/definitions/NoteGroup"
              },
              "type": "array"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Groups"
        },
        "velocity": {
          "default": 80,
          "maximum": 127,
          "minimum": 1,
          "title": "Velocity",
          "type": "integer"
        },
        "hand": {
          "anyOf": [
            {
              "enum": [
                "lh",
                "rh"
              ],
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Hand"
        },
        "motif": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Motif"
        },
        "section": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Section"
        },
        "phrase": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Phrase"
        }
      },
      "required": [
        "start",
        "duration"
      ],
      "title": "NoteEvent",
      "type": "object"
    },
    "NoteGroup": {
      "description": "A sub-chord within a NoteEvent: multiple pitches sharing the same hand/voice.",
      "properties": {
        "pitches": {
          "items": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "string"
              }
            ]
          },
          "title": "Pitches",
          "type": "array"
        },
        "hand": {
          "enum": [
            "lh",
            "rh"
          ],
          "title": "Hand",
          "type": "string"
        },
        "voice": {
          "anyOf": [
            {
              "maximum": 4,
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Voice"
        }
      },
      "required": [
        "pitches",
        "hand"
      ],
      "title": "NoteGroup",
      "type": "object"
    },
    "PedalEvent": {
      "description": "Sustain pedal (CC 64) event. `value` defaults to 127.\n\nDuration can be 0 for instant pedal releases (value=0) or instant pedal presses.",
      "properties": {
        "type": {
          "const": "pedal",
          "default": "pedal",
          "title": "Type",
          "type": "string"
        },
        "start": {
          "minimum": 0,
          "title": "Start",
          "type": "number"
        },
        "duration": {
          "minimum": 0,
          "title": "Duration",
          "type": "number"
        },
        "value": {
          "default": 127,
          "maximum": 127,
          "minimum": 0,
          "title": "Value",
          "type": "integer"
        },
        "section": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Section"
        },
        "phrase": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Phrase"
        }
      },
      "required": [
        "start",
        "duration"
      ],
      "title": "PedalEvent",
      "type": "object"
    },
    "TempoEvent": {
      "description": "Tempo change event. Supports both instant and gradual tempo changes.\n\nFor instant tempo changes:\n- Provide `bpm` (the new tempo at `start`)\n\nFor gradual tempo changes (ritardando/accelerando):\n- Provide `start_bpm` and `end_bpm` (tempo at start and end of the change)\n- Provide `duration` (how long the change takes in beats)\n- The system will approximate the gradual change with discrete tempo steps\n\nNote: Tempo events can be placed in any track; they will be collected and\nrendered in the conductor track during MIDI generation.",
      "properties": {
        "type": {
          "const": "tempo",
          "default": "tempo",
          "title": "Type",
          "type": "string"
        },
        "start": {
          "minimum": 0,
          "title": "Start",
          "type": "number"
        },
        "bpm": {
          "anyOf": [
            {
              "exclusiveMaximum": 400,
              "minimum": 20,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Bpm"
        },
        "start_bpm": {
          "anyOf": [
            {
              "exclusiveMaximum": 400,
              "minimum": 20,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Start Bpm"
        },
        "end_bpm": {
          "anyOf": [
            {
              "exclusiveMaximum": 400,
              "minimum": 20,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "End Bpm"
        },
        "duration": {
          "anyOf": [
            {
              "exclusiveMinimum": 0,
              "type": "number"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Duration"
        },
        "section": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Section"
        },
        "phrase": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Phrase"
        }
      },
      "required": [
        "start"
      ],
      "title": "TempoEvent",
      "type": "object"
    },
    "TimeSignature": {
      "properties": {
        "numerator": {
          "maximum": 32,
          "minimum": 1,
          "title": "Numerator",
          "type": "integer"
        },
        "denominator": {
          "default": 4,
          "enum": [
            1,
            2,
            4,
            8,
            16,
            32
          ],
          "title": "Denominator",
          "type": "integer"
        }
      },
      "required": [
        "numerator"
      ],
      "title": "TimeSignature",
      "type": "object"
    },
    "Track": {
      "properties": {
        "name": {
          "default": "Piano",
          "title": "Name",
          "type": "string"
        },
        "channel": {
          "default": 0,
          "maximum": 15,
          "minimum": 0,
          "title": "Channel",
          "type": "integer"
        },
        "program": {
          "default": 0,
          "maximum": 127,
          "minimum": 0,
          "title": "Program",
          "type": "integer"
        },
        "events": {
          "items": {
            "oneOf": [
              {
                "$ref": "#/definitions/NoteEvent"
              },
              {
                "$ref": "#/definitions/PedalEvent"
              },
              {
                "$ref": "#/definitions/TempoEvent"
              }
            ]
          },
          "title": "Events",
          "type": "array"
        }
      },
      "title": "Track",
      "type": "object"
    }
  }
}